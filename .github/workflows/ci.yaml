# name: Test CI

# on:
#   pull_request:

# env:
#   CARGO_TERM_COLOR: always

# jobs:
#   tests:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Cache Cargo dependencies
#         uses: actions/cache@v4
#         with:
#           path: |
#             ~/.cargo/registry
#             ~/.cargo/git
#             target
#           key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.toml') }}
#           restore-keys: |
#             ${{ runner.os }}-cargo-

#       - name: Install Rust toolchain
#         uses: actions-rs/toolchain@v1
#         with:
#           profile: minimal
#           toolchain: stable
#           override: true

#       # - name: Build
#       #   run: cargo build

#       # - name: Generate documentation
#       #   run: cargo doc --no-deps

#       - name: Pull Bitcoin Docker Image
#         run: docker pull bitcoin/bitcoin:29.1

#       - name: Run tests
#         run: cargo test -- --test-threads=1

name: 'rust-bitvmx-wallet: CI Test'
on:
  push:
    branches: [ "main" ]
   
  pull_request:
    branches: [ "main" ]

env:
  CARGO_TERM_COLOR: always

permissions:
  actions: read
  checks: write
  contents: read
  pull-requests: read

concurrency:
  group: '${{ github.workflow }} @ ${{ github.event.pull_request.head.label || github.head_ref || github.ref }}'
  cancel-in-progress: true

jobs:
  test:
    uses: FairgateLabs/BitVMX-CI/.github/workflows/ci_local_template.yml@main
    with:
      repo: 'FairgateLabs/rust-bitvmx-workspace'
      submodule_path: 'rust-bitvmx-wallet'
      cargo_lock_path: 'rust-bitvmx-wallet/Cargo.lock'
      target_path: 'rust-bitvmx-wallet/target'
      submodule_branches: '{}'
      single_thread_tests: true
    secrets: inherit
